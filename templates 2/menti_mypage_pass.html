<!doctype html>
<html lang="en" style="overflow-x: auto;background: #FAFAFA">
<head>

    <!-- Webpage Title -->
    <title>{{ menti_info.nickname }}님의 마이페이지</title>
    {% extends "layout_2.html" %}

    {% block head %}

    <style>
        * {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 16px;
        }

        .navbar-item{font-weight: 600;font-size: 15px;transition-duration: 0.3s;}
        .navbar-item:hover {
            background-color: #FAFAFA;
            color: #577FF0;
        }
        .dropdown-item{transition-duration: 250ms}
        .dropdown-item:hover {
            letter-spacing: 2px;
        }
        #nav_drop_logout:hover{
            color: #F08080;
        }

        .div_up {
            width: 0px;
            height: 0px;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-bottom: 12px solid #dedede;
            margin-left: 158.5px;
        }

        .box{
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .box::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera*/
        }
        .modal-content{
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .modal-content::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera*/
        }
        button{
            opacity: 0.85;
            transition-duration: 300ms
        }
        button:hover{
            opacity: 1;
            letter-spacing: 2px
        }

        .alert_box{
            width: 341px;min-height: 75px;max-height: 340px;background: white;border: 1px #dedede solid;border-radius: 4px;
            box-shadow: 2px 6px 2px rgba(0, 0, 0, 0.25);padding: 20px 25px 6px 25px;
            overflow-y: scroll;
        }
        .alert_delete_btn{background: none;border: white 1px solid;cursor: pointer;height: 20px;border-radius: 10px;line-height: 18px;color: #E94E58;font-size: 12px;position: absolute;right: 134px;top: 9px;transition-duration: 300ms}
        .alert_delete_btn:hover{font-weight: 600;border: #F08080 1px solid;}
        .follow_box{
            width: 480px;height: 70px;padding: 15px;background: #FAFAFA;border-radius: 4px;display: flex;
            position: relative;margin-bottom: 14px;
            cursor: pointer;
        }
        .follow_box >p {
            margin-left: 17px;line-height: 40px;text-overflow:ellipsis; width: 370px; overflow:hidden; white-space:nowrap
        }
        .red_dot{
            width: 12px;height: 12px;border-radius: 6px;background: #E94E58;
            position: absolute; right: 15px;top: 29px;
        }

        .head {
            font-size: 21px;
            color: #595959;
            margin-bottom: 30px;
            cursor: pointer; transition-duration: 200ms;
        }
        .head:hover {
            font-size: 24px;
            font-weight: 700;
            color: #333333;
        }
        .grey_area{
            width: 990px;
            max-height: 443px;
            border-radius: 4px;
            line-height: 32px;
            background:linear-gradient(100.08deg, #EFEFEF 5.16%, #F5F5F5 91.74%);
            padding: 14px 17px
        }
        .cancel_btn{
            border: #dedede 1px solid;background: white;color: #797979;width: max-content;padding: 4px 12px;
            height: 24px;border-radius: 12px;line-height: 14px;
        }


        .footer > div > p > a {
            font-size: 12px;
            color: black;
        }
    </style>
    <script type="text/javascript">
        $(document).ready(function () {

        })
        function totop() {
            $("html, body").animate({scrollTop: 0}, 240);
        }

        function sign_out() {
            //로그아웃
            if (confirm('정말로 로그아웃 하시겠습니까?')){
                $.removeCookie('mytoken', {path: '/'});
                window.location.href="/login"
            }
        }

    </script>
    {% endblock %}

    {% block content %}
<div style="width: 1194px; margin: 90px auto 40px auto">
    <div style="display: flex; margin-bottom: 80px">
        <div style="width: 72px;height: 72px;overflow: hidden;border-radius: 36px;border: none;">
            <img src="../static/{{ menti_info.profile_pic_real }}"
                 style="width:100%;height: 100%;object-fit: cover;">
        </div>

        <div style="margin-left: 30px; height: 72px;">
            <div style="color: #111111;font-size: 24px; margin-bottom: 11px">{{ menti_info.nickname }}</div>
            <p style="border: none; color: #595959;width: 800px;font-size: 14px;">
                {% if menti_info.phone %}
                    {{ menti_info.phone }}
                {% else %}
                    {{ menti_info.email }}
                {% endif %}
            </p>
        </div>
    </div>
    <div style="display: flex;position: relative">
        <div style="width: 174px;margin-right: 40px">
            <div onclick="window.location.href='/menti_mypage_pass/{{ menti_info.nickname }}'" onmouseover="$('#head_2_1, #head_2_2, #head_2_3, #head_2_4, #head_3_1, #head_3_2').addClass('is-hidden');" id="head_1" class="head" style="font-size: 24px;font-weight: 700;color: #333333;">연간 패스/결제</div>
            <div onclick="window.location.href='/menti_mypage_mydata/{{ menti_info.nickname }}?mt=1'" onmouseover="$('#head_2_1, #head_2_2, #head_2_3, #head_2_4').removeClass('is-hidden')" id="head_2" class="head">내 데이터</div>
            <div onclick="window.location.href='/menti_mypage_mydata/{{ menti_info.nickname }}?mt=1'" id="head_2_1" class="head is-hidden" style="font-size: 16px;margin-top: -18px">구매한 데이터</div>
            <div onclick="window.location.href='/menti_mypage_mydata/{{ menti_info.nickname }}?mt=2'" id="head_2_2" class="head is-hidden" style="font-size: 16px;margin-top: -18px">스트리밍한 데이터</div>
            <div onclick="window.location.href='/menti_mypage_mydata/{{ menti_info.nickname }}?mt=3'" id="head_2_3" class="head is-hidden" style="font-size: 16px;margin-top: -18px">북마크</div>
            <div onclick="window.location.href='/menti_mypage_mydata/{{ menti_info.nickname }}?mt=4'" id="head_2_4" class="head is-hidden" style="font-size: 16px;margin-top: -18px">찜한 데이터</div>
            <div onclick="window.location.href='/menti_mypage_mystory/{{ menti_info.nickname }}?mt=1'" onmouseover="$('#head_3_1, #head_3_2').removeClass('is-hidden')" id="head_3" class="head">내 스토리</div>
            <div onclick="window.location.href='/menti_mypage_mystory/{{ menti_info.nickname }}?mt=1'" id="head_3_1" class="head is-hidden" style="font-size: 16px;margin-top: -18px">스트리밍한 스토리</div>
            <div onclick="window.location.href='/menti_mypage_mystory/{{ menti_info.nickname }}?mt=2'" id="head_3_2" class="head is-hidden" style="font-size: 16px;margin-top: -18px">북마크</div>
            <div onclick="window.location.href='/menti_mypage_info/{{ menti_info.nickname }}'" onmouseover="$('#head_2_1, #head_2_2, #head_2_3, #head_2_4, #head_3_1, #head_3_2').addClass('is-hidden');" id="head_4" class="head">회원정보수정</div>
        </div>
<!--        좌측 탭-->

        <div>
            <div style="width: 990px">
                {% if menti_info.pass != '' %}
                    <div class="grey_area">
                        {% set pass = menti_info.pass %}
                        <script>
                            $(document).ready(function () {
                                var str = '{{ pass }}';
                                var pd = str.split(',')[0].split('/')[0] + '년 ' + str.split(',')[0].split('/')[1] + '월 ' + str.split(',')[0].split('/')[2] + '일 ' + str.split(',')[1].split(':')[0] + ':' + str.split(',')[1].split(':')[1] + ':' + str.split(',')[1].split(':')[2]
                                var ed = parseInt(str.split(',')[0].split('/')[0]) + 1 + '년 ' + str.split(',')[0].split('/')[1] + '월 ' + str.split(',')[0].split('/')[2] + '일 ' + str.split(',')[1].split(':')[0] + ':' + str.split(',')[1].split(':')[1] + ':' + str.split(',')[1].split(':')[2]
                                $('#pd').text(pd)
                                $('#pd2').text(pd)
                                $('#ed').text(ed)
                            })
                        </script>
                        <p style="font-size: 21px;margin-bottom: 10px">이용 현황</p>
                        <p>연간 패스 이용중입니다.</p>
                        <br>
                        <p style="color: #577FF0">레디메이트 연간 패스</p>
                        <table>
                            <tr>
                                <td style="width: 180px">이용 기간</td>
                                {% for pay1 in my_pay %}
                                {% if pay1.category == 'pass' %}
                                <td>{{ pay1.pay_time }} ~ {{ pay1.exp_time }}</td>
                            </tr>
                            <tr>
                                <td style="width: 180px">결제일</td>
                                <td id="pd2">{{ pay1.pay_time }}</td>
                            </tr>
                            <tr>
                                <td style="width: 180px">결제 금액</td>
                                <td><span>{{ pay1.price }}</span> 원</td>
                                {% endif %}
                                {% endfor %}
                            </tr>
                        </table>
                    </div>
                {% else %}
                    <div class="grey_area">
                        <p style="font-size: 21px;margin-bottom: 10px">이용 현황</p>
                        <p style="color: #333333">연간 패스를 이용하고 있지 않습니다.<br>레디메이트 연간 패스를 사용해 대학생 멘토들의 입시데이터를 1년간 무제한으로 열람하세요!</p>
                        <br>
                        <div style="display: flex;justify-content: space-evenly;">
                            <div style="width: 417px; height: 157px;color: #333333;line-height: 48px;width: max-content;margin-left: 49px">
                                <p style="font-size: 18px;text-align: right">추가금 없이 <b style="font-size: 21px;color: #577FF0;letter-spacing: 1px">모든 입시데이터</b> 열람 가능</p>
                                <p style="font-size: 18px;text-align: right">90일 → <b style="font-size: 21px;color: #577FF0;letter-spacing: 1px">365일</b>, 열람기간은 더 길게</p>
                                <p style="font-size: 18px;text-align: right">패스 기간 동안 열람 가능 횟수 <b style="font-size: 21px;color: #577FF0;letter-spacing: 1px">무제한</b></p>
                            </div>
                            <img style="height: 157px;margin-right: 80px" src="../static/readypass_page/rp_7.png">
                        </div>
                        <br><br>
                        <button onclick="window.location.href='/readypass'" style="width: 264px;margin-left: 333px;height: 40px;border-radius: 20px;cursor:pointer;margin-right: 29px;border: none;color: white;font-weight: 600;background: linear-gradient(90.83deg, #55DBC2 0%, #52C0E2 38.33%, #577FF0 64.9%, #7351E1 100%);">
                            레디메이트 연간패스 보러가기
                        </button>
                        <br><br>
                    </div>
                {% endif %}
                <br><br>

                <p style="font-size: 21px;margin-bottom: 10px;margin-left: 12px">구매 내역</p>
                <p style="margin-left: 12px">개별 데이터, 패스권을 포함한 나의 모든 결제 내역입니다.</p>
                <br>

                {% if my_pay|length == 0 %}
                <div style="width: 990px;max-height: 443px;border-radius: 4px;line-height: 32px;background:linear-gradient(100.08deg, #EFEFEF 5.16%, #F5F5F5 91.74%);padding: 14px 17px">
                    <p style="color: #595959;line-height: 132px;text-align: center">추가 구매 내역이 없어요.</p>
                </div><br>
                {% else %}
                    {% for pay in my_pay %}
                        {% if pay.category == 'pass' %}
                            <div style="width: 990px;max-height: 443px;border-radius: 4px;line-height: 32px;background:linear-gradient(100.08deg, #EFEFEF 5.16%, #F5F5F5 91.74%);padding: 14px 17px">
                                <p style="color: #577FF0">레디메이트 연간 패스</p>
                                <table>
                                    <tr>
                                        <td style="width: 180px">이용 기간</td>
                                        <td><span>{{ pay.pay_time }}</span> ~ <span>{{ pay.exp_time }}</span></td>
                                    </tr>
                                    <tr>
                                        <td style="width: 180px">결제일</td>
                                        <td><span>{{ pay.pay_time }}</span></td>
                                    </tr>
                                    <tr>
                                        <td style="width: 180px">결제 금액</td>
                                        <td><span>{{ pay.price }}</span> 원</td>
                                    </tr>
                                </table>
                                {% if pay.cancel %}
                                <button style="float: right" class="cancel_btn" onclick="cancel(this)">결제 취소</button>
                                {% endif %}
                            <br>
                            </div>
                            <br>
                        {% else %}
                            <div style="width: 990px;max-height: 443px;border-radius: 4px;line-height: 32px;background:linear-gradient(100.08deg, #EFEFEF 5.16%, #F5F5F5 91.74%);padding: 14px 17px">
                                {% if pay.category == 'recordpaper' %}
                                    <p style="color: #577FF0;font-size: 14px">생활기록부</p>
                                {% elif pay.category == 'resume' %}
                                    <p style="color: #577FF0;font-size: 14px">자기소개서</p>
                                {% else %}
                                    <p style="color: #577FF0;font-size: 14px">레디메이트 연간패스</p>
                                {% endif %}
                                <table>
                                    {% if pay.category != 'readypass' %}
                                    <tr>
                                        <td style="width: 180px">상품 제목</td>
                                        <td>{{ pay.title }}</td>
                                    </tr>
                                    {% endif %}
                                    <tr>
                                        <td style="width: 180px">결제 방식</td>
                                        <td>{{ pay.method_name }} ({% if pay.card_quota == '00' %}일시불{% else %}{{ pay.card_quota }}개월 할부{% endif %}) {% if pay.card_name != 'undefined' %}{{ pay.card_name }}{% endif %} {% if pay.card_no != '*********' %}{{ pay.card_no }}{% endif %}</td>
                                    </tr>
                                    <tr>
                                        <td style="width: 180px">이용 기간</td>
                                        <td><span>{{ pay.pay_time }}</span> ~ <span>{{ pay.exp_time }}</span></td>
                                    </tr>
                                    <tr>
                                        <td style="width: 180px">결제일</td>
                                        <td><span>{{ pay.pay_time }}</span></td>
                                    </tr>
                                    <tr>
                                        <td style="width: 180px">결제 금액</td>
                                        <td><span>{{ pay.price }}</span> 원</td>
                                    </tr>
                                </table>{{ pay.cancel }}
                                {% if pay.cancel %}
                                <button id="{{ pay.number }}_{{ pay.category }}_{{ pay.time }}" style="float: right" class="cancel_btn" onclick="cancel(this)">결제 취소</button>
                                {% endif %}
                            <br>
                            </div>
                            <br>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </div>
        <script>
            function cancel(obj){
                var reason = prompt('취소 사유를 입력해주세요')
                var info = obj.id
                var mentor_num = info.split('_')[0]
                var category = info.split('_')[1]
                var time = info.split('_')[2]
                let form_data = new FormData
                form_data.append('category', category)
                form_data.append('time', time)
                form_data.append('number', mentor_num)
                form_data.append('reason', reason)
                $.ajax({
                    type: "POST",
                    url: `/pay_cancel/{{ me_info.number }}`,
                    data: form_data,
                    cache: false,
                    contentType: false, processData: false,
                    success: function (response) {
                        alert('결제 취소되었습니다')
                    }
                })
            }
        </script>

        <br>
            <div>
                <p style="color: #111111">안내사항</p><br>
                <li style="font-size: 14px;margin-bottom: 8px">연간 패스 구매내역을 타인에게 양도하거나, 다른 아이디로 이전하는 기능은 제공하지 않습니다.</li>
                <li style="font-size: 14px;margin-bottom: 8px">연간 패스 금액은 부가세(10%)가 포함된 금액입니다.</li>
                <li style="font-size: 14px;margin-bottom: 8px">결제 상세내역은 현재 페이지에서 결제한 패스를 클릭하면 확인 가능합니다.</li>
                <li style="font-size: 14px;margin-bottom: 8px">결제 후 7일 이내에 데이터를 열람하지 않았을 시에는 전액 환불이 가능하며, 이후로는 이용 기간과 이용
                    데이터에 대한 금액을 제하고 환불이 가능합니다.
                </li>
                <li style="font-size: 14px;margin-bottom: 8px">환불요청은 고객명, 휴대폰 번호(또는 이메일) 정보와 함께 우측 하단의 말풍선을 눌러 1:1 문의로
                    남겨주세요. (고객문의에 대한 답변은 평일 10~5시 사이에 가능합니다.)
                </li>
                <li style="font-size: 14px;margin-bottom: 8px">연간 패스 이용 기간이 남아 있는 경우, 연간 패스 이용 종료일 전날까지 환불이 가능합니다.</li>
                <li style="font-size: 14px;margin-bottom: 8px">연간 패스 혜택은 연간 패스 이용 기간 중에만 적용됩니다.</li>
            </div>
        </div>
    </div>
</div>
    {% endblock %}

