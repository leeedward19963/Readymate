<!doctype html>
<html lang="en" style="overflow-x: auto;background: #FAFAFA">
<head>

    <!-- Webpage Title -->
    <title>{{ menti_info.nickname }}님의 마이페이지</title>
    {% extends "layout_2.html" %}

    {% block head %}

    <style>
        * {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 16px;
        }

        .navbar-item{font-weight: 600;font-size: 15px;transition-duration: 0.3s;}
        .navbar-item:hover {
            background-color: #FAFAFA;
            color: #577FF0;
        }
        .dropdown-item{transition-duration: 250ms}
        .dropdown-item:hover {
            letter-spacing: 2px;
        }
        #nav_drop_logout:hover{
            color: #F08080;
        }

        .div_up {
            width: 0px;
            height: 0px;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-bottom: 12px solid #dedede;
            margin-left: 158.5px;
        }

        .box{
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .box::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera*/
        }
        .modal-content{
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .modal-content::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera*/
        }
        button{
            opacity: 0.85;
            transition-duration: 300ms
        }
        button:hover{
            opacity: 1;
            letter-spacing: 2px
        }

        .alert_box{
            width: 341px;min-height: 75px;max-height: 340px;background: white;border: 1px #dedede solid;border-radius: 4px;
            box-shadow: 2px 6px 2px rgba(0, 0, 0, 0.25);padding: 20px 25px 6px 25px;
            overflow-y: scroll;
        }
        .alert_delete_btn{background: none;border: white 1px solid;cursor: pointer;height: 20px;border-radius: 10px;line-height: 18px;color: #E94E58;font-size: 12px;position: absolute;right: 134px;top: 9px;transition-duration: 300ms}
        .alert_delete_btn:hover{font-weight: 600;border: #F08080 1px solid;}
        .follow_box{
            width: 480px;height: 70px;padding: 15px;background: #FAFAFA;border-radius: 4px;display: flex;
            position: relative;margin-bottom: 14px;
            cursor: pointer;
        }
        .follow_box >p {
            margin-left: 17px;line-height: 40px;text-overflow:ellipsis; width: 370px; overflow:hidden; white-space:nowrap
        }
        .red_dot{
            width: 12px;height: 12px;border-radius: 6px;background: #E94E58;
            position: absolute; right: 15px;top: 29px;
        }
        .drop_select:hover{font-weight: 600}
        .product_card_body {
            text-align: right; color: #333333;line-height: 21px;position: relative;
            width: 276px;
            height: 186px;
            background: linear-gradient(136.34deg, rgba(115, 81, 225, 0.15) 25.51%, rgba(87, 127, 240, 0.15) 51.59%, rgba(82, 192, 226, 0.15) 75.59%);
            border-radius: 4px;
            padding: 14px 24px 18px 0;cursor: pointer;
            transition-duration:  350ms;
        }
        .product_card_body:hover {
            box-shadow: rgba(119, 43, 172, 0.15) 10px 0 70px 0px inset;
        }

        .head {
            font-size: 21px; font-weight: 500;
            color: #595959;
            margin-bottom: 30px;
            cursor: pointer; transition-duration: 200ms;
        }
        .head:hover {
            font-size: 24px;
            font-weight: 700;
            color: #333333;
        }
        .selectedTab{
            color: #333333;font-weight: 700
        }
        .cat {
            width: 120px;height: 34px;border-radius: 17px;border: none;
            background: #E7DDFD; color: #573BC1;
            margin-right: 25px;
            cursor: pointer; transition-duration: 250ms;
        }
        .cat:hover{
            background: #7351E1; color: white;
        }
        .selectedCat{
            background: #7351E1; color: white;
        }

        .empty_list{
            width: 990px; height: 154px;background: white;border-radius: 4px;border: #dedede 1px solid;
            text-align: center;line-height: 148px;color: #797979;
        }

        .product_desc{
            width: 695px; height: 186px; margin-left: 19px;
        }
        .un_bookmark_btn {
            color: #577FF0;font-size: 14px;background: none;border:#577FF0 1px solid;width: 130px;height: 34px;border-radius: 7px
        }
        .un_wishlist_btn {
            color: #55DBC2;font-size: 14px;background: none;border:#55DBC2 1px solid;width: 130px;height: 34px;border-radius: 7px
        }

        .footer > div > p > a {
            font-size: 12px;
            color: black;
        }
    </style>
    <script type="text/javascript">
        var miniTab1Array=[];
        var miniTab2Array=[];
        var listCount;
        var cat_1_num;
        var cat_2_num;
        var cat_3_num;
        var cat_4_num;
        var cat_5_num;
        var cat_6_num;

        $(document).ready(function () {
            filter(0);miniTab({{ param|int }})

        })
        function totop() {
            $("html, body").animate({scrollTop: 0}, 240);
        }

        function miniTab(i){
            var emptyMentArray = ['읽은 스토리가 없습니다.','스크랩한 스토리가 없습니다.'];
            $('.empty_list').text(emptyMentArray[i-1])
            $('#head_3_1, #head_3_2').removeClass('selectedTab')
            $(`#head_3_${i}`).addClass('selectedTab')

            //탭에 따라 맞는 정보 겟.
            //겟해서 위서 전역으로 선언한 array를 채움.
            //반복문을 돌면서 mydatalist에 append
            //append시킬 원형은 아래에 기본형 만들어둠.
            //desc 부분에 id_1,2,3,4 붙여놓은 부분이 tab1,2,3,4에 따라 받아올 데이터.
            $('.desc_1,.desc_2').addClass('is-hidden')
            $(`.desc_${i}`).removeClass('is-hidden')

            listCount = document.querySelector('#mydata_list');

            if ( i== 1){
                $('.item').addClass('is-hidden')
                $('.streaming').removeClass('is-hidden')
            } else {
                $('.item').addClass('is-hidden')
                $('.bookmark').removeClass('is-hidden')
            }

            cat_1_num = listCount.querySelectorAll('.cat_1:not(.is-hidden)').length;
            cat_2_num = listCount.querySelectorAll('.cat_2:not(.is-hidden)').length;
            cat_3_num = listCount.querySelectorAll('.cat_3:not(.is-hidden)').length;
            cat_4_num = listCount.querySelectorAll('.cat_4:not(.is-hidden)').length;
            cat_5_num = listCount.querySelectorAll('.cat_5:not(.is-hidden)').length;
            cat_6_num = listCount.querySelectorAll('.cat_6:not(.is-hidden)').length;

            var total_num = cat_1_num+cat_2_num+cat_3_num+cat_4_num+cat_5_num+cat_6_num
            console.log(total_num,cat_1_num,cat_2_num,cat_3_num,cat_4_num,cat_5_num,cat_6_num)
            $('#cat0Num').text(total_num);$('#cat1Num').text(cat_1_num);$('#cat2Num').text(cat_2_num);
            $('#cat3Num').text(cat_3_num);$('#cat4Num').text(cat_4_num);$('#cat5Num').text(cat_5_num);$('#cat6Num').text(cat_6_num);
            if (total_num == 0) {
                $('#mydata_list').addClass('is-hidden')
                $('.empty_list').removeClass('is-hidden')
            } else {
                $('#mydata_list').removeClass('is-hidden')
                $('.empty_list').addClass('is-hidden')
            }
            ///총 몇개의 데이터 보이는 그거
        }

        function filter(i) {
            $('.cat').removeClass('selectedCat');
            if (i==0){
                $('.cat_1').removeClass('is-hidden')
                $('.cat_2').removeClass('is-hidden')
                $('.cat_3').removeClass('is-hidden')
                $('.cat_4').removeClass('is-hidden')
                $('.cat_5').removeClass('is-hidden')
                $('.cat_6').removeClass('is-hidden')
            } else if (i==1) {
                if (cat_1_num == 0) {
                    $('#mydata_list').addClass('is-hidden')
                    $('.empty_list').removeClass('is-hidden')
                } else {
                    $('#mydata_list').removeClass('is-hidden')
                    $('.empty_list').addClass('is-hidden')
                    for (let k = 1; k < 7; k++) {
                        $(`.cat_${k}`).addClass('is-hidden')
                    }
                    $(`.cat_1`).removeClass('is-hidden')
                }
            } else if (i==2) {
                if (cat_2_num == 0) {
                    $('#mydata_list').addClass('is-hidden')
                    $('.empty_list').removeClass('is-hidden')
                } else {
                    $('#mydata_list').removeClass('is-hidden')
                    $('.empty_list').addClass('is-hidden')
                    for (let k = 1; k < 7; k++) {
                        $(`.cat_${k}`).addClass('is-hidden')
                    }
                    $(`.cat_2`).removeClass('is-hidden')
                }
            } else if (i==3) {
                if (cat_3_num == 0) {
                    $('#mydata_list').addClass('is-hidden')
                    $('.empty_list').removeClass('is-hidden')
                } else {
                    $('#mydata_list').removeClass('is-hidden')
                    $('.empty_list').addClass('is-hidden')
                    for (let k = 1; k < 7; k++) {
                        $(`.cat_${k}`).addClass('is-hidden')
                    }
                    $(`.cat_3`).removeClass('is-hidden')
                }
            } else if (i==4) {
                if (cat_4_num == 0) {
                    $('#mydata_list').addClass('is-hidden')
                    $('.empty_list').removeClass('is-hidden')
                } else {
                    $('#mydata_list').removeClass('is-hidden')
                    $('.empty_list').addClass('is-hidden')
                    for (let k = 1; k < 7; k++) {
                        $(`.cat_${k}`).addClass('is-hidden')
                    }
                    $(`.cat_4`).removeClass('is-hidden')
                }
            } else if (i==5) {
                if (cat_5_num == 0) {
                    $('#mydata_list').addClass('is-hidden')
                    $('.empty_list').removeClass('is-hidden')
                } else {
                    $('#mydata_list').removeClass('is-hidden')
                    $('.empty_list').addClass('is-hidden')
                    for (let k = 1; k < 7; k++) {
                        $(`.cat_${k}`).addClass('is-hidden')
                    }
                    $(`.cat_5`).removeClass('is-hidden')
                }
            } else if (i==6) {
                if (cat_6_num == 0) {
                    $('#mydata_list').addClass('is-hidden')
                    $('.empty_list').removeClass('is-hidden')
                } else {
                    $('#mydata_list').removeClass('is-hidden')
                    $('.empty_list').addClass('is-hidden')
                    for (let k = 1; k < 7; k++) {
                        $(`.cat_${k}`).addClass('is-hidden')
                    }
                    $(`.cat_6`).removeClass('is-hidden')
                }
            }
            var parentButton = document.querySelector(`#cat${i}Num`).parentElement
            parentButton.className = "cat selectedCat"
        }

        function sign_out() {
            //로그아웃
            if (confirm('정말로 로그아웃 하시겠습니까?')){
                $.removeCookie('mytoken', {path: '/'});
                window.location.href="/login"
            }
        }

    </script>
    {% endblock %}

    {% block content %}
<div style="width: 1194px; margin: 90px auto 40px auto">
    <div style="display: flex; margin-bottom: 80px">
        <div style="width: 72px;height: 72px;overflow: hidden;border-radius: 36px;border: none;">
            <img src="../static/{{ menti_info.profile_pic_real }}"
                 style="width:100%;height: 100%;object-fit: cover;">
        </div>

        <div style="margin-left: 30px; height: 72px;">
            <div style="color: #111111;font-size: 24px; margin-bottom: 11px">{{ menti_info.nickname }}</div>
            <p style="border: none; color: #595959;width: 800px;font-size: 14px;">
                {% if menti_info.phone %}
                    {{ menti_info.phone }}
                {% else %}
                    {{ menti_info.email }}
                {% endif %}
            </p>
        </div>
    </div>
    <div style="display: flex;position: relative">
        <div style="width: 174px;margin-right: 40px">
            <div style="position: sticky;top: 70px;left: 0px">
                <div onclick="window.location.href='/menti_mypage_pass/{{ menti_info.nickname }}'" onmouseover="$('#head_2_1,#head_2_2,#head_2_3,#head_2_4').addClass('is-hidden');" id="head_1" class="head">연간 패스/결제</div>
                <div onclick="window.location.href='/menti_mypage_mydata/{{ menti_info.nickname }}?mt=1'" onmouseover="$('#head_2_1,#head_2_2,#head_2_3,#head_2_4').removeClass('is-hidden');" id="head_2" class="head">내 데이터</div>
                <div onclick="window.location.href='/menti_mypage_mydata/{{ menti_info.nickname }}?mt=1'" id="head_2_1" class="head is-hidden" style="font-size: 16px;margin-top: -18px">구매한 데이터</div>
                <div onclick="window.location.href='/menti_mypage_mydata/{{ menti_info.nickname }}?mt=2'" id="head_2_2" class="head is-hidden" style="font-size: 16px;margin-top: -18px">스트리밍한 데이터</div>
                <div onclick="window.location.href='/menti_mypage_mydata/{{ menti_info.nickname }}?mt=3'" id="head_2_3" class="head is-hidden" style="font-size: 16px;margin-top: -18px">스크랩</div>
                <div onclick="window.location.href='/menti_mypage_mydata/{{ menti_info.nickname }}?mt=4'" id="head_2_4" class="head is-hidden" style="font-size: 16px;margin-top: -18px">찜한 데이터</div>
                <div onclick="miniTab(1)" id="head_3" class="head" style="font-size: 24px;font-weight: 700;color: #333333;">내 스토리</div>
                <div onclick="miniTab(1)" id="head_3_1" class="head selectedTab" style="font-size: 16px;margin-top: -18px">스트리밍한 스토리</div>
                <div onclick="miniTab(2)" id="head_3_2" class="head" style="font-size: 16px;margin-top: -18px">스크랩</div>
                <div onclick="window.location.href='/menti_mypage_info/{{ menti_info.nickname }}'" onmouseover="$('#head_2_1,#head_2_2,#head_2_3,#head_2_4').addClass('is-hidden');" id="head_4" class="head">회원정보수정</div>
            </div>
        </div>
<!--        좌측 탭-->

        <div style="width: 990px">
            <p style="">카테고리</p><br>
            <div style="display: flex">
                <button onclick="filter(0)" class="cat selectedCat">전체 (<span id="cat0Num"></span>)</button>
                <button onclick="filter(1)" class="cat">공부자극 (<span id="cat1Num"></span>)</button>
                <button onclick="filter(2)" class="cat">입시정보 (<span id="cat2Num"></span>)</button>
                <button onclick="filter(3)" class="cat">공부법 (<span id="cat3Num"></span>)</button>
                <button onclick="filter(4)" class="cat">대학생활 (<span id="cat4Num"></span>)</button>
                <button onclick="filter(5)" class="cat">진로 (<span id="cat5Num"></span>)</button>
                <button onclick="filter(5)" class="cat">기타 팁 (<span id="cat6Num"></span>)</button>
            </div>

            <hr>

            <div id="mydata_list">
                {% for story in my_data %}
                    {% if story['cat'] == '공부자극' %}
                        <div class="item cat_1 {{ story['miniTab'] }}" style="display: flex;width: 990px; height: 212px;padding: 13px 0;border-bottom: 1px solid #F1F1F1;">
                    {% elif story['cat'] == '입시정보' %}
                        <div class="item cat_2 {{ story['miniTab'] }}" style="display: flex;width: 990px; height: 212px;padding: 13px 0;border-bottom: 1px solid #F1F1F1;">
                    {% elif story['cat'] == '공부법' %}
                        <div class="item cat_3 {{ story['miniTab'] }}" style="display: flex;width: 990px; height: 212px;padding: 13px 0;border-bottom: 1px solid #F1F1F1;">
                    {% elif story['cat'] == '대학생활' %}
                        <div class="item cat_4 {{ story['miniTab'] }}" style="display: flex;width: 990px; height: 212px;padding: 13px 0;border-bottom: 1px solid #F1F1F1;">
                    {% elif story['cat'] == '진로' %}
                        <div class="item cat_5 {{ story['miniTab'] }}" style="display: flex;width: 990px; height: 212px;padding: 13px 0;border-bottom: 1px solid #F1F1F1;">
                    {% elif story['cat'] == '기타 팁' %}
                        <div class="item cat_6 {{ story['miniTab'] }}" style="display: flex;width: 990px; height: 212px;padding: 13px 0;border-bottom: 1px solid #F1F1F1;">
                    {% endif %}
                            <div style="width: 276px;display: flex">
                                <div onclick="window.location.href='/story/{{ story['mentor_num'] }}/{{ story['product'] }}'" class="product_card_body">
                                    <div style="width: 84px; height: 84px;overflow: hidden;border-radius: 43px;border: #55DBC2 4px solid;margin: 0 0 8px 172px">
                                        <div style="width: 76px;height: 76px;overflow: hidden;border-radius: 38px;background-clip: padding-box;border: rgba(0,0,0,0) 5px solid;">
                                            <img src="../static/{{ story['img'] }}" style="width:100%;height: 100%;object-fit: cover;">
                                        </div>
                                    </div>
                                    <div style="z-index: 2;position: absolute;right: 22px;top: 76px;background: none;"><img style="height: 28px;margin-top: -6px" src="../static/emoji/story.png"></div>
                                    <div style="font-size: 14px;text-align: right; color: #595959;line-height: 22px">
                                        <p style="font-weight: bold">{{ story['univ'] }}</p>
                                        <p style="font-size: 12px">{{ story['major'] }} {{ story['student_num'] }}학번</p>
                                        <p style="font-size: 12px">{{ story['type'] }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="product_desc" style="position: relative">
                                <p style="font-size: 12px; color: #595959;">스토리 &#183; {{ story['cat'] }}</p>
                                <p style="color: #111111">{{ story['title'] }}</p>
                                <p style="margin-top: 4px;color: #797979; font-size: 14px">
                                    <img style="height: 12px;margin-top: -6px" src="../static/emoji/like.png">&nbsp; <span style="font-size: 14px">{{ story['like'] }}</span>&nbsp;&nbsp;&nbsp; <img style="height: 12px;margin-top: -6px" src="../static/emoji/reply.png">&nbsp; <span style="font-size: 14px">{{ story['reply'] }}</span>
                                </p>
                                <div>
                                    <script>
                                        function bookmark_remove() {
                                            $.ajax({
                                                type: "POST",
                                                url: "/bookmark_remove",
                                                data: {number_give:{{ story['mentor_num'] }}, category_give: "story", time_give:'{{ story['product'] }}'},
                                                success: function (response) {
                                                    window.location.reload()
                                                }
                                            });
                                        }
                                    </script>
                                    <div id="" class="is-hidden desc_1" style="position: absolute;bottom: 5px">
                                        <p class="hide_warning" style="visibility: hidden;font-size: 12px;color: #595959"><i class="fa fa-clock-o" aria-hidden="true"></i> 이 데이터는 멘토의 요청으로 30일 뒤부터 열람할 수 없습니다.</p>
                                        <p style="font-size: 12px;color: #595959"><i class="fa fa-eye" aria-hidden="true"></i> <span style="font-size: 12px;color: #595959">{{ story['time'] }}</span> 읽음</p>
                                    </div>
                                    <div id="" class="is-hidden desc_2" style="position: absolute;bottom: 5px;right: 57px">
                                        <button style="cursor:pointer" onclick="bookmark_remove()" class="un_bookmark_btn">
                                            <i class="fa fa-bookmark" aria-hidden="true"></i> 스크랩 취소
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                {% endfor %}
            </div>
            <div class="empty_list"></div>
        </div>
    </div>
</div>
    {% endblock %}