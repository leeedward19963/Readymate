<!doctype html>
<html lang="en" style="overflow-x: auto;background: #FAFAFA">
<head>

    <!-- Webpage Title -->
    <title>READYMATE | 스토리작성</title>
    {% extends "layout_2.html" %}

    {% block head %}
    <style>
        #editor-container {
            height: 400px;
        }

        * {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 16px;
        }
        .navbar-item{font-weight: 600;font-size: 15px;transition-duration: 0.3s;}
        .navbar-item:hover {
            background-color: #FAFAFA;
            color: #577FF0;
        }
        .dropdown-item{transition-duration: 250ms}
        .dropdown-item:hover {
            letter-spacing: 2px;
        }
        #nav_drop_logout:hover{
            color: #F08080;
        }
        .box{
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .box::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera*/
        }
        .modal-content{
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .modal-content::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera*/
        }
        button{
            opacity: 0.85;
            transition-duration: 300ms
        }
        button:hover{
            opacity: 1;
            letter-spacing: 2px
        }
        .div_up{
            width: 0px;
            height: 0px;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-bottom: 12px solid #dedede;
            margin-left: 158.5px;
        }
        .alert_box{
            width: 341px;min-height: 75px;max-height: 340px;background: white;border: 1px #dedede solid;border-radius: 4px;
            box-shadow: 2px 6px 2px rgba(0, 0, 0, 0.25);padding: 20px 25px 6px 25px;
            overflow-y: scroll;
        }
        .alert_delete_btn{background: none;border: white 1px solid;cursor: pointer;height: 20px;border-radius: 10px;line-height: 18px;color: #E94E58;font-size: 12px;position: absolute;right: 134px;top: 9px;transition-duration: 300ms}
        .alert_delete_btn:hover{font-weight: 600;border: #F08080 1px solid;}
        .follow_box{
            width: 480px;height: 70px;padding: 15px;background: #FAFAFA;border-radius: 4px;display: flex;
            position: relative;margin-bottom: 14px;
            cursor: pointer;
        }
        .follow_box >p {
            margin-left: 17px;line-height: 40px;text-overflow:ellipsis; width: 370px; overflow:hidden; white-space:nowrap
        }
        .red_dot{
            width: 12px;height: 12px;border-radius: 6px;background: #E94E58;
            position: absolute; right: 15px;top: 29px;
        }

        /* Chrome, Safari, Edge, Opera */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox */
        input[type=number] {
            -moz-appearance: textfield;
        }

        .head {
            cursor:pointer; font-weight: 500;font-size: 21px; color: #595959;margin-bottom: 50px;
        }

        .grey_box {
            width: 684px;
            background:linear-gradient(100.08deg, #EFEFEF 5.16%, #F5F5F5 91.74%);
            border-radius: 4px;
            padding: 10px 30px 15px 30px;
            line-height: 29px;
            color: #595959;
        }
        input{background: none}
        .cat{
            width: 130px;height: 40px;border-radius: 4px;border: none;
            background: #BCD3FD;color: white;font-weight: 600;
            transition-duration: 250ms;cursor: pointer;
        }
        .cat:hover{
            letter-spacing: 2px;color: #2B46AC;
        }
        .selectedCat{
            background: #3F61CE; color: white;
        }
        #sell {
            cursor:auto; font-weight: 500;width: 174px;height: 40px;border-radius: 20px;color: #797979;border: none;background: #D4D4D4;
            transition-duration: 400ms;
        }

        .footer > div > p > a {
            font-size: 12px;
            color: black;
        }
    </style>
    <script type="text/javascript">

        let sel_list = document.getElementsByClassName('selected_tag');
        $(document).ready(function () {
            $('#title_input').on('keyup', function () {
                if ($(this).val().length > 32) {
                    $(this).val($(this).val().substring(0, 32));
                    $('#title_cnt').html("(32 / 32)");
                }
                $('#title_cnt').html("(" + $(this).val().length + " / 32)");
                var text = $('#title_input').val()
            })

            $('.cat').on('click',function (){
                $('.cat').removeClass('selectedCat')
                $(this).addClass('selectedCat')
                ///이 스토리의 카테고리를 포스트. 선택된 카테고리는 selectedCat클래스를 가지니 저장할때 이 클래스가진 오브젝트의 텍스트 읽기
            })
        })

        window.onbeforeunload = function () {
            return "정말로 페이지를 벗어나시겠습니까? 입력한 데이터는 저장되지 않습니다."
        }

        var year;
        var month;
        var date;
        var hour;
        var minute;
        var second;

        function getTime() {
            var nowDate = new Date().toLocaleDateString()
            var nowTime = new Date().toLocaleTimeString()

            year = nowDate.split('.')[0] + '년 '
            month = nowDate.split('.')[1] + '월 '
            date = nowDate.split('.')[2] + '일 '
            hour = nowTime.split(':')[0] + '시 '
            minute = nowTime.split(':')[1] + '분'
            second = nowTime.split(':')[2] + '초'

        }


        function totop() {
            $("html, body").animate({scrollTop: 0}, 240);
        }

        function tab_to(i) {
            $("html, body");
            $('#tab_list').animate({left: `-${(i - 1) * 684}`}, 300, 'swing');
            $('.head').css({'font-size': '21px', 'font-weight': '500'});
            $(`#head_${i}`).css({'font-size': '24px', 'font-weight': '700'});
        }

        function next_tab(i) {
            $("html, body").animate({scrollTop: 220}, 0);
            $('#tab_list').animate({left: "-=684"}, 300, "swing")
            if (i == 1) {
                $('#tab_slider').css({'height': '760'})
                $('#recordpaper_view').addClass('is-hidden')
                $('#tab_3_btn_sub').addClass('is-hidden')
            } else {
                $('#tab_slider').css({'height': '700'})
                $('#recordpaper_view').addClass('is-hidden')
                $('#tab_3_btn_sub').addClass('is-hidden')
            }

            $(`#head_${i}`).css({'font-size': '21px', 'font-weight': '500'});
            $(`#head_${i + 1}`).css({'font-size': '24px', 'font-weight': '700'})
        }

        function fill_title() {
            var text = $('#title_input').val().toString()
            $('#title').text(text)
            if (text){
                $('#title_btn').css({ 'background': 'white','color':'#577FF0'})
                $('#title_btn').text('수정')
            } else {
                $('#title_btn').css({ 'background': '#577FF0','color':'white'})
                $('#title_btn').text('입력')
            }
        }

        function save_sto_post() {
            var warningArray = [];
            var record_desc = quill.container.firstElementChild.textContent
            var categoty = $('.selectedCat').text()
            if ($('#title_input').val() != '' && categoty != ''){
                $('#verify_tab_1').css({ 'visibility' : 'visible'})
            } else {
                $('#verify_tab_1').css({ 'visibility' : 'hidden'})
                warningArray.push("기본정보 탭이 다 입력되지 않았습니다")
            }
            ///1탭 브이체크표시 만드는 if

            if (record_desc != '' && record_desc != '<p>내용을 입력하세요...</p>'){
                $('#verify_tab_2').css({ 'visibility' : 'visible' })
            } else {
                $('#verify_tab_2').css({ 'visibility' : 'hidden'})
                warningArray.push("스토리 입력 탭이 다 입력되지 않았습니다")
            }
            ///2탭 브이체크표시 만드는 if

            var check_1 = $('#verify_tab_1').css('visibility');
            var check_2 = $('#verify_tab_2').css('visibility');

            if (check_1 == 'visible' && check_2 == 'visible'){
                fill_title()
                getTime()
                let quillHTML = quill.container.firstElementChild.innerHTML
                //위에는 퀼 안에 들어간 HTML코드이고, 아래는 실제 텍스트 내용. 아래 변수는 내용이 입력되었는지의 여부를 검토하기 위해.
                let story_title = $("#title_input").val()
                var time = year + month + date + ' ' + hour + minute + second
                let form_data = new FormData()
                form_data.append("story_title_give", story_title)
                form_data.append("story_category_give", categoty)
                form_data.append("story_desc_give", quillHTML)
                form_data.append("story_time_give", time)
                console.log(story_title, quillHTML, categoty, time, form_data)
                $.ajax({
                    type: "POST",
                    url: `/story_save/{{ mentor_info.number }}/{{ time }}`,
                    data: form_data,
                    cache: false,
                    contentType: false, processData: false,
                    success: function (response) {
                        window.onbeforeunload = null
                        if (response['result'] == 'modify'){
                            alert(response['msg'])
                            window.location.href=`/story/{{ mentor_info.number }}/{{ time }}`
                        } else if (response['result'] == 'save') {
                            alert(response['msg'])
                            window.location.href=`/story/{{ mentor_info.number }}/${time}`
                        } else {
                            alert('저장에 실패했습니다')
                        }
                    }
                });
            } else {
                alert(warningArray[0])
            }
        }

        function sellornot(){
            var sell = 'sell'
            console.log(sell)
            $.ajax({
                type: "POST",
                url: "/story_sellyes",
                data: {'sell': sell},
                success: function (response) {
                    $("#activity_modal").removeClass("is-active")
                    window.alert('자료가 공개되어 멘티가 열람 가능합니다.')
                }
            });
        }

        function sign_out() {
            //로그아웃
            if (confirm('정말로 로그아웃 하시겠습니까?')){
                $.removeCookie('mytoken', {path: '/'});
                window.location.href="/login"
            }
        }

    </script>
    {% endblock %}

    {% block content %}
    <div style="width: 1194px; margin: 90px auto 40px auto">
    <div style="display: flex; margin-bottom: 80px">
        <div style="width: 72px;height: 72px;overflow: hidden;border-radius: 36px;border: #f1f1f1 1px solid;margin: 2px 10px 0 0">
            <img src="../../static/{{ me_info.profile_pic_real }}"
                 style="width:100%;height: 100%;object-fit: cover;">
        </div>
        <div style="margin-left: 30px; height: 72px;">
            <div style="display: flex;line-height: 30px">
            <div style="color: #595959;margin-bottom: 19px">{{ mentor_info.nickname }}</div><div style="margin-left: 10px;line-height: 30px; width: 78px;text-align: center;font-weight: 500; height: 30px;border-radius: 15px;background: #55DBC2;color: white;border: none;">스토리</div>
            </div>
            <p id="title" style="border: none; color: black;width: 800px;font-size: 21px;margin-right: 16px">{{ story_info.story_title|safe }}</p>
        </div>
    </div>
    <div style="display: flex;position: relative">
        <div style="width: 174px; margin-right: 132px;bottom:100px;">
            <div onclick="tab_to(1);$('#tab_slider').css({'height': '700'});" id="head_1" class="head" style="font-weight: 700;font-size: 24px;">기본정보 <i id="verify_tab_1" class="fa fa-check-circle-o" style="color: #577FF0;visibility: hidden;" aria-hidden="true"></i></div>
            <div onclick="tab_to(2);$('#tab_slider').css({'height': '760'});" id="head_2" class="head" style="margin-bottom: 70px">스토리 입력 <i id="verify_tab_2" class="fa fa-check-circle-o" style="color: #577FF0;visibility: hidden;" aria-hidden="true"></i></div>
<!--            위에 일부러 onmouseenter로 그냥 css에니메이션 줘봤는데, 공개하기 버튼이 활성화 되면 저 css변화 에니메이션이 적용되도록 해줘-->
        </div>
        <div id="tab_slider" style="width: 684px; overflow: hidden; position: relative;height: 700px;">
            <div id="tab_list" style="position: absolute;display: flex;">
                <div id="tab_1" style="width: 684px">
                    <p style="font-size: 21px; font-weight: 600">제목</p><br>
                    <div class="grey_box" style="margin-bottom: 24px">
                        <p style="font-weight: 600">TIP</p>
                        <p style="font-size: 14px;">잘 만든 제목은 조회수를 높이는 데 도움이 됩니다. 멘티들의 궁금증을 자극하는 제목을 작성해보세요!</p>
                        <li style="font-size: 14px">스토리의 특징을 나타내는 키워드들을 사용해보세요. </li>
                        <li style="font-size: 14px">이 스토리를 통해 도움을 얻을 수 있을 타겟 멘티들을 드러내보세요.</li>
                        <li style="font-size: 14px">글자수는 32자로 제한됩니다.</li>
                    </div>
                    <input id="title_input"
                           style="border: none; border-bottom: #797979 1px solid;margin-right: 10px; width: 590px; height: 24px; padding: 4px 5px" type="text" value="{{ story_info.story_title|safe }}"
                           placeholder="데이터를 잘 표현하는 제목을 입력해주세요.">
                    <button id="title_btn" onclick="fill_title()" style="cursor: pointer; width: 73px; height: 28px;border-radius: 15px;font-weight: 500; color: white;background: #577FF0;border:#577FF0 1px solid;">입력</button>
                    <p id="title_cnt" style="float: right;margin-right: 93px">0/32</p>
                    <br><br><br><br>

                    <p style="font-size: 21px; font-weight: 600">카테고리 설정</p><br>
                    <div style="display: flex;justify-content: space-evenly">
                        <button class="cat">공부자극</button>
                        <button class="cat">입시정보</button>
                        <button class="cat">공부법</button>
                    </div>
                    <div style="display: flex;justify-content: space-evenly;margin-top: 20px">
                        <button class="cat">대학생활</button>
                        <button class="cat">진로</button>
                        <button class="cat">기타 팁</button>
                    </div>


                    <br><br><br><br>
                    <div style="display: flex; float: right">
                        <button onclick="next_tab(1)"
                                style="cursor: pointer;font-weight: 500;width: 102px;height: 40px;border-radius: 20px;color: #577FF0;border: #577FF0 1px solid;background-color: white">
                            다음으로
                        </button>
                    </div>
                </div>
                <div id="tab_2" style="width: 684px">
                    <p style="font-size: 21px; font-weight: 600">상세 페이지</p><br>
                    <div class="grey_box" style="margin-bottom: 30px">
                        <p style="font-weight: 600">TIP</p>
                        <p style="font-size: 14px;">스토리는 합격수기, 정보전달, 칼럼, 일정소개, 공부법, 공부자극 등 다양한 내용을 모두 쓸 수 있는 공간입니다.<br>
                            매력적인 스토리는 멘토님의 데이터 조회수를 높이는 데 큰 도움이 됩니다.</p>
                    </div>

                    <div id="editor-container" >
                        <div id="editor">
                            {{ story_info.story_desc|safe }}
                        </div>
                        <script>
                            var quill = new Quill('#editor', {
                                modules: {
                                    toolbar: [
                                              //[{ header: [1, 2, false] }],
                                              ['bold', 'italic', 'underline',{'color':['#444','#577FF0','#3EBCB0','#C657EF','#52C0E2','#E94E58']}],
                                              ['image','link']
                                            ]
                                },
                                theme: 'snow'
                            });
                        </script>
                    </div>

                    <br><br><br><br>

                    <div style="display: flex; float: right">
                        <button id="save_sto_post" onclick="save_sto_post()" style="cursor: pointer;margin-right: 20px; font-weight: 500;width: 102px;height: 40px;border-radius: 20px;color: white;border: none;background-color: #577FF0">
                            저장하기
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    {% endblock %}